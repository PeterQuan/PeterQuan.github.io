<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.webp">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.webp">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"peterquan.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="时间需要留下走过的痕迹">
<meta property="og:type" content="website">
<meta property="og:title" content="Quan Qinle">
<meta property="og:url" content="https://peterquan.github.io/index.html">
<meta property="og:site_name" content="Quan Qinle">
<meta property="og:description" content="时间需要留下走过的痕迹">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="权芹乐">
<meta property="article:tag" content="编程">
<meta property="article:tag" content=" 测试">
<meta property="article:tag" content=" 计算机">
<meta property="article:tag" content=" 人生">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://peterquan.github.io/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Quan Qinle</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Quan Qinle</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">权芹乐的博客 | QuanQinle's Blog</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://peterquan.github.io/2020/06/30/UT-Springboot-test-the-web-layer/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.webp">
      <meta itemprop="name" content="权芹乐">
      <meta itemprop="description" content="时间需要留下走过的痕迹">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Quan Qinle">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/30/UT-Springboot-test-the-web-layer/" class="post-title-link" itemprop="url">UT | Controller层单元测试</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-07-01 00:00:00" itemprop="dateCreated datePublished" datetime="2020-07-01T00:00:00+08:00">2020-07-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-07-03 17:28:26" itemprop="dateModified" datetime="2020-07-03T17:28:26+08:00">2020-07-03</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>[toc]</p>
<p>我的环境：</p>
<ul>
<li>Java 8+</li>
<li>Maven 3</li>
<li>Spring Boot 2</li>
<li>Junit 5</li>
</ul>
<p>Controller的单元测试很多时候都不容易做到隔离，不得不依赖下层类的逻辑、数据库、网络、第三方服务等等，所以，有时人们又将它归为接口测试，类似于HTTP API测试。</p>
<h1 id="测试的几种类型"><a href="#测试的几种类型" class="headerlink" title="测试的几种类型"></a>测试的几种类型</h1><p>注意下面示例代码在类注释处的区别！</p>
<h2 id="1-启动服务，监听端口，发送真实的http请求"><a href="#1-启动服务，监听端口，发送真实的http请求" class="headerlink" title="1. 启动服务，监听端口，发送真实的http请求"></a>1. 启动服务，监听端口，发送真实的http请求</h2><p>Start the application up and listen for a connection like it would do in production, and then send an HTTP request and assert the response.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.test.web.client.TestRestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@RunWith</span>(SpringRunner.class) // needed if junit 4</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ExtendWith</span>(SpringExtension.class) // for junit 5</span></span><br><span class="line"><span class="comment"> * 正常情况下可省略，因<span class="doctag">@SpringBootTest</span>已包含，但是，如果你用的spring boot版本低，还是加上这个注解吧</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootTest</span>(webEnvironment = WebEnvironment.RANDOM_PORT)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpRequestTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@LocalServerPort</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> port; <span class="comment">// bind the above RANDOM_PORT</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  <span class="keyword">private</span> TestRestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGreeting</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    assertThat(restTemplate.getForObject(<span class="string">"http://localhost:"</span> + port + <span class="string">"/"</span>, String<span class="class">.<span class="keyword">class</span>))</span></span><br><span class="line">      .contains("Hello World");</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-不启动服务（但实例化整个上下文），却类似发送真实http请求"><a href="#2-不启动服务（但实例化整个上下文），却类似发送真实http请求" class="headerlink" title="2. 不启动服务（但实例化整个上下文），却类似发送真实http请求"></a>2. 不启动服务（但实例化整个上下文），却类似发送真实http请求</h2><p>The full Spring application context is started but without the server.</p>
<p>Another useful approach is to not start the server at all, but test only the layer below that, where Spring handles the incoming HTTP request and hands it off to your controller. That way, almost the full stack is used, and your code will be called exactly the same way as if it was processing a real HTTP request, but without the cost of starting the server.</p>
<blockquote>
<p>译：另一种有用的方法是根本不启动服务器，而是只测试下面的层，Spring在这一层处理传入的HTTP请求并将其传递给控制器。这样，几乎使用了整个堆栈，代码调用的方式与处理实际HTTP请求的方式完全相同，但是不需要启动服务器。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.web.servlet.MockMvc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.test.web.servlet.result.MockMvcResultMatchers.content;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@AutoConfigureMockMvc</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MockMvcExampleTests</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  <span class="keyword">private</span> MockMvc mvc;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">testHelloWorld</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    mvc.perform(get(<span class="string">"/"</span>))</span><br><span class="line">      .andExpect(status().isOk())</span><br><span class="line">      .andExpect(content().string(<span class="string">"Hello World"</span>));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上两种方法会实例化整个上下文。（Spring Boot is instantiating the whole context.）</p>
<p>可以将<code>@SpringBootTest</code>理解成集成测试。</p>
<hr>
<p><em>注意上下两段代码，在类注释处的区别</em>  </p>
<p>方法3只实例化web层。<br>Spring Boot is only instantiating the web layer.（If you want to focus <strong><span style="color:red"><em>only</em></span> on the web layer</strong> and <strong><span style="color:red"><em>not start</em></span> a complete ApplicationContext</strong>, consider using <code>@WebMvcTest</code> instead.）</p>
<h2 id="3-不启动服务（仅实例化web层），却类似发送真实http请求"><a href="#3-不启动服务（仅实例化web层），却类似发送真实http请求" class="headerlink" title="3. 不启动服务（仅实例化web层），却类似发送真实http请求"></a>3. 不启动服务（仅实例化web层），却类似发送真实http请求</h2><p>In this test, the full Spring application context is started, but without the server. We can narrow down the tests to just the web layer by using <code>@WebMvcTest</code>.  </p>
<blockquote>
<p>译：在这个测试中，启动了完整的Spring应用程序上下文，但是没有服务器。我们可以使用<code>@WebMvcTest</code>将测试范围缩小到web层。<br>如果应用含有多个controller，可以使用<code>@WebMvcTest(homecontroler.class)</code>来只实例化一个控制器。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebMvcTest</span>(GreetingController<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">WebMockTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  <span class="keyword">private</span> MockMvc mockMvc;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@MockBean</span></span><br><span class="line">  <span class="keyword">private</span> GreetingService service;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGreetingShouldReturnMessageFromService</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    when(service.greet()).thenReturn(<span class="string">"Hello Mock"</span>);</span><br><span class="line"></span><br><span class="line">    mockMvc.perform(get(<span class="string">"/greeting"</span>))</span><br><span class="line">      .accept(MediaType.APPLICATION_JSON_UTF8)</span><br><span class="line">      <span class="comment">// 添加ResultHandler结果处理器，比如调试时打印结果到控制台，更多处理器可查阅</span></span><br><span class="line">      .andDo(print())</span><br><span class="line">      <span class="comment">// 添加ResultMatcher验证规则，验证请求结果是否正确</span></span><br><span class="line">      .andExpect(status().isOk())</span><br><span class="line">      <span class="comment">// andReturn：返回执行请求的结果，该结果是一个MvcResult实例对象</span></span><br><span class="line">      .andExpect(content().string(containsString(<span class="string">"Hello Mock"</span>)));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-Mock下层所有调用"><a href="#4-Mock下层所有调用" class="headerlink" title="4. Mock下层所有调用"></a>4. Mock下层所有调用</h2><p>只关注<code>Controller</code>层逻辑，被测中所涉及的调用全部打桩、mock掉。</p>
<p>与其他三个相比，方法4是比较合乎分层测试理念的方式。但在实际项目中，个人的体会，这种方式可操作性并不强。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MockitoControllerTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@InjectMocks</span></span><br><span class="line">  <span class="keyword">private</span> UserController userController;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Mock</span></span><br><span class="line">  <span class="keyword">private</span> UserRepository userRepository;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@BeforeEach</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    MockitoAnnotations.initMocks(<span class="keyword">this</span>); <span class="comment">//【必须！】初始化@Mock</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetUserById</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    User u = <span class="keyword">new</span> User();</span><br><span class="line">    u.setId(<span class="number">1L</span>);</span><br><span class="line">    </span><br><span class="line">    when(userRepository.findOne(<span class="number">1L</span>)).thenReturn(u);</span><br><span class="line"></span><br><span class="line">    User user = userController.get(<span class="number">1L</span>);</span><br><span class="line">    verify(userRepository).findOne(<span class="number">1L</span>);</span><br><span class="line">    assertEquals(<span class="number">1l</span>, user.getId().longValue());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="重要注解"><a href="#重要注解" class="headerlink" title="重要注解"></a>重要注解</h1><h2 id="SpringBootTest"><a href="#SpringBootTest" class="headerlink" title="@SpringBootTest"></a><code>@SpringBootTest</code></h2><p>The <code>@SpringBootTest</code> annotation tells Spring Boot to go and look for a main configuration class (one with <code>@SpringBootApplication</code> for instance), and use that to <strong>start a Spring application context</strong>.</p>
<p>注释告诉SpringBoot去寻找一个主配置类（例如带有<code>@SpringBootApplication</code>的配置类），并使用它来启动一个Spring应用程序上下文。</p>
<blockquote>
<p>Springboot默认只启动一次应用，并缓存它。对于使用配置相同的多个tc，或者一个tc中的多个method，就可以共用它。当然，可以使用<code>@DirtiesContext</code>来控制缓存。</p>
</blockquote>
<p>它有两个属性：</p>
<ul>
<li>webEnvironment：指定Web应用环境，它可以是以下值<ul>
<li>MOCK：提供一个模拟的 Servlet 环境，内置的 Servlet 容器没有启动（不会对Servlet、Filter、Listener等进行初始化），配合可以与@AutoConfigureMockMvc 结合使用，用于基于 MockMvc 的应用程序测试。</li>
<li>RANDOM_PORT：加载一个 EmbeddedWebApplicationContext 并提供一个真正嵌入式的 Servlet 环境，随机端口。</li>
<li>DEFINED_PORT：加载一个 EmbeddedWebApplicationContext 并提供一个真正嵌入式的 Servlet 环境，默认端口 8080 或由配置文件指定。</li>
<li>NONE：使用 SpringApplication 加载 ApplicationContext，但不提供任何 servlet 环境。</li>
</ul>
</li>
<li>classes：指定应用启动类，通常情况下无需设置，因为 SpringBoot 会自动搜索，直到找到 @SpringBootApplication 或 @SpringBootConfiguration 注解。</li>
</ul>
<h2 id="Transactional"><a href="#Transactional" class="headerlink" title="@Transactional"></a><code>@Transactional</code></h2><p>它会在每个测试方法结束时会进行回滚操作。<br>但是，如果使用 <code>RANDOM_PORT</code> 或 <code>DEFINED_PORT</code> 这样的Servlet环境，HTTP客户端和服务器将在不同的线程中运行，从而分离事务。所以，在这种情况下，在服务器上启动的任何事务都不会回滚。</p>
<h1 id="资料"><a href="#资料" class="headerlink" title="资料"></a>资料</h1><p><a href="https://spring.io/guides/gs/testing-web/" target="_blank" rel="noopener">Offical &gt; Testing the Web Layer</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://peterquan.github.io/2020/06/29/CSS-Selector-summary/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.webp">
      <meta itemprop="name" content="权芹乐">
      <meta itemprop="description" content="时间需要留下走过的痕迹">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Quan Qinle">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/29/CSS-Selector-summary/" class="post-title-link" itemprop="url">Selenium | 元素定位By.cssSelector()</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-06-30 00:00:00" itemprop="dateCreated datePublished" datetime="2020-06-30T00:00:00+08:00">2020-06-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-07-03 17:28:26" itemprop="dateModified" datetime="2020-07-03T17:28:26+08:00">2020-07-03</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>[toc]</p>
<p>CSS Selector 使用CSS定位元素</p>
<h1 id="CSS-Selector是什么？"><a href="#CSS-Selector是什么？" class="headerlink" title="CSS Selector是什么？"></a><code>CSS Selector</code>是什么？</h1><blockquote>
<p>[MDN web docs]</p>
<p>CSS selectors define the elements to which a set of CSS rules apply.</p>
</blockquote>
<blockquote>
<p>[w3schools]</p>
<p>In CSS, selectors are patterns used to select the element(s) you want to style.</p>
</blockquote>
<h1 id="CSS-Selector语法"><a href="#CSS-Selector语法" class="headerlink" title="CSS Selector语法"></a>CSS Selector语法</h1><h2 id="4个基础选择器"><a href="#4个基础选择器" class="headerlink" title="4个基础选择器"></a>4个基础选择器</h2><p>个人认为，<code>CSS Selector</code>最重要的选择器只有下面4个，分别是 tagname标签名称，标签id属性，class属性，以及其他属性：</p>
<ul>
<li>tag</li>
<li>#id</li>
<li>.class</li>
<li>[attribute=value]</li>
</ul>
<p>这4个的各种组合，可以出现丰富、强大的效果。</p>
<p>举几个例子</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">tag</span><span class="selector-id">#id</span></span><br><span class="line"><span class="selector-tag">tag</span><span class="selector-class">.class</span></span><br><span class="line">tag.class1.class2   // 多个class</span><br><span class="line"><span class="selector-tag">tag</span><span class="selector-attr">[attributeName=<span class="string">'attributeValue'</span>]</span></span><br><span class="line">tag[attributeName='attributeValue'][attributeName2='attributeValue2'] // 多个属性</span><br><span class="line">tag#id.class[attributeName='attributeValue'] // 4个选择器</span><br></pre></td></tr></table></figure>

<h2 id="更多选择器"><a href="#更多选择器" class="headerlink" title="更多选择器"></a>更多选择器</h2><p>下面再列几个我常用的选择器。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*-- 属性的模糊匹配 --*/</span></span><br><span class="line">// ^ - Starts with</span><br><span class="line"><span class="selector-attr">[attribute^=<span class="string">'attributeValue'</span>]</span></span><br><span class="line">// $ - Ends with</span><br><span class="line"><span class="selector-attr">[attribute$=<span class="string">'attributeValue'</span>]</span></span><br><span class="line">// * - Contains</span><br><span class="line"><span class="selector-attr">[attribute*=<span class="string">'attributeValue'</span>]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*-- 父子节点 --*/</span></span><br><span class="line">// 直接子节点，多个（parentLocator&gt;childLocator）。XPath: //div/a</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-id">#buttonDiv</span>&gt;<span class="selector-tag">button</span></span><br><span class="line">// 相对子节点，多个（locator1 locator2）。XPath: //div//a</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-id">#buttonDiv</span> <span class="selector-tag">button</span></span><br><span class="line">// 同一父节点下的第n个子元素，从1开始（:nth-child(n)）。下例，若li不是其父的第2位节点，则失败；数位子时，所有类型一起数</span><br><span class="line"><span class="selector-id">#testingTypes</span> <span class="selector-tag">li</span><span class="selector-pseudo">:nth-child(2)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*-- 兄弟节点 --*/</span></span><br><span class="line">// 紧邻的下一个节点，1个（locator1+locator2）</span><br><span class="line"><span class="selector-tag">li</span><span class="selector-id">#automation</span> + <span class="selector-tag">li</span></span><br><span class="line">// 其后的兄弟节点，可以被其他兄弟隔断（element1~element2）</span><br><span class="line"><span class="selector-tag">p</span>~<span class="selector-tag">ul</span></span><br></pre></td></tr></table></figure>

<p>CSS Selector还有其他复杂的语法，但上面我们讲到的已经是精华，实用性最强。</p>
<p>更多的见资料 [^1]</p>
<h1 id="Selenium中的CSS-Selector"><a href="#Selenium中的CSS-Selector" class="headerlink" title="Selenium中的CSS Selector"></a><code>Selenium</code>中的<code>CSS Selector</code></h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">By by &#x3D; By.cssSelector(String selector);</span><br><span class="line">&#x2F;&#x2F;Find elements via the driver&#39;s underlying W3C Selector engine.</span><br></pre></td></tr></table></figure>

<p>示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">By.cssSelector(<span class="string">"button[id='stop']"</span>)  </span><br><span class="line">By.cssSelector(<span class="string">"button#stop"</span>)  </span><br><span class="line">By.cssSelector(<span class="string">"#stop"</span>)  </span><br><span class="line"></span><br><span class="line">By.cssSelector(<span class="string">"button.x-right-button"</span>)   </span><br><span class="line">By.cssSelector(<span class="string">".x-right-button"</span>) </span><br><span class="line"><span class="comment">// &lt;button class="x-btn-text module_picker_icon" /&gt; </span></span><br><span class="line">By.cssSelector(<span class="string">"button.x-btn-text.module_picker_icon"</span>)  <span class="comment">// 多个class</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//^=start with $=ends with *=contains</span></span><br><span class="line">By.cssSelector(<span class="string">"input[id^='Em']"</span>)</span><br><span class="line">By.cssSelector(<span class="string">"input[id$='wd']"</span>)</span><br><span class="line">By.cssSelector(<span class="string">"input[id*='ni']"</span>) <span class="comment">// 使用a[href*='.jpg']成功！</span></span><br><span class="line">By.cssSelector(<span class="string">"a:contains('Sign in')"</span>) </span><br><span class="line"><span class="comment">//contains试用失败！原因见下文invalid selector: An invalid or illegal selector was specified</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">By.cssSelector(<span class="string">"a[title=\"Go to Facebook home\"]"</span>)</span><br><span class="line">By.cssSelector(<span class="string">"input[id='signIn'][value='Sign in']"</span>) <span class="comment">// 多个属性</span></span><br><span class="line">By.cssSelector(<span class="string">"div#west-panel&gt;div:nth-child(1)&gt;div:nth-child(1)&gt;div:nth-child(2)&gt;div"</span>) </span><br><span class="line">By.cssSelector(<span class="string">"td.col5&gt;div&gt;input:nth-child(4)"</span>) <span class="comment">// nth-child(4) 表示查找第四个Pseudo-selements元素</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// XPATH: //input[@id='username']/following-sibling::input[1]</span></span><br><span class="line">By.cssSelector(<span class="string">".username + input"</span>)</span><br></pre></td></tr></table></figure>


<h1 id="不能通过文本contains定位元素的问题"><a href="#不能通过文本contains定位元素的问题" class="headerlink" title="不能通过文本contains定位元素的问题"></a>不能通过文本<code>contains</code>定位元素的问题</h1><p>有一点需要特别注意，不能使用 <code>a:contains(&#39;Sign in&#39;)</code>。</p>
<p>原因：</p>
<ol>
<li><strong>Inner texts</strong><br>are the actual string patterns that the HTML label shows on the page.  </li>
<li>(Not supported by WebDriver)<br>CSS: The CSS2 contains() function is not in CSS3; however, Selenium supports the superset of CSS1, 2, and 3.<br>contains() is not part of the current CSS3 specification so it will not work on all browsers, only ones that implemented it before it was pulled.</li>
</ol>
<p>遇到此种场景，可以使用<code>By by = By.ByXPath(String xpathExpression)</code>。<br>xpath见资料 [^2]</p>
<h1 id="资料"><a href="#资料" class="headerlink" title="资料"></a>资料</h1><p>[^1]: CSS Selector详解：<a href="https://www.w3schools.com/cssref/css_selectors.asp" target="_blank" rel="noopener">https://www.w3schools.com/cssref/css_selectors.asp</a></p>
<p>[^2]: CSS Selector与xpath语法比较：<a href="https://saucelabs.com/resources/articles/selenium-tips-css-selectors" target="_blank" rel="noopener">https://saucelabs.com/resources/articles/selenium-tips-css-selectors</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://peterquan.github.io/2020/06/14/my-basic-views-on-unite-testing/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.webp">
      <meta itemprop="name" content="权芹乐">
      <meta itemprop="description" content="时间需要留下走过的痕迹">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Quan Qinle">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/14/my-basic-views-on-unite-testing/" class="post-title-link" itemprop="url">我对自动化测试的基本观点</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-06-15 00:00:00" itemprop="dateCreated datePublished" datetime="2020-06-15T00:00:00+08:00">2020-06-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-07-03 17:28:26" itemprop="dateModified" datetime="2020-07-03T17:28:26+08:00">2020-07-03</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>[toc]</p>
<h1 id="什么是自动化测试？"><a href="#什么是自动化测试？" class="headerlink" title="什么是自动化测试？"></a>什么是自动化测试？</h1><p>不想说话</p>
<h1 id="为什么要进行自动化测试？自动化测试的好处"><a href="#为什么要进行自动化测试？自动化测试的好处" class="headerlink" title="为什么要进行自动化测试？自动化测试的好处"></a>为什么要进行自动化测试？自动化测试的好处</h1><p>不想说话</p>
<h1 id="自动化测试的类型"><a href="#自动化测试的类型" class="headerlink" title="自动化测试的类型"></a>自动化测试的类型</h1><h2 id="常规分类"><a href="#常规分类" class="headerlink" title="常规分类"></a>常规分类</h2><p>通常我们听到最多的分类方式是：</p>
<ul>
<li>单元测试 unit testing</li>
<li>接口测试 API testing</li>
<li>界面测试 user interface testing</li>
</ul>
<p>这个分类法很合理，也容易理解，唯一的问题是在实际实施的时候，所写的有些用例很难区分是单元测试还是接口测试。</p>
<h2 id="按大小分类"><a href="#按大小分类" class="headerlink" title="按大小分类"></a>按大小分类</h2><p>下面是 <a href="https://cloud.tencent.com/developer/article/1490961" target="_blank" rel="noopener">腾讯新闻产品组提出的分类方式</a>，我认为具有很好的可操作性：</p>
<ul>
<li>小型测试，针对单个函数的测试，关注其内部逻辑，mock所有需要的服务。小型测试带来优秀的代码质量、良好的异常处理、优雅的错误报告</li>
<li>中型测试，验证两个或多个制定的模块应用之间的交互</li>
<li>大型测试，也被称为“系统测试”或“端到端测试”。大型测试在一个较高层次上运行，验证系统作为一个整体是如何工作的。</li>
</ul>
<table>
<thead>
<tr>
<th>资源</th>
<th>小型测试</th>
<th>中型测试</th>
<th>大型测试</th>
</tr>
</thead>
<tbody><tr>
<td>网络访问</td>
<td>否</td>
<td>仅访问localhost</td>
<td>是</td>
</tr>
<tr>
<td>数据库访问</td>
<td>否</td>
<td>是</td>
<td>是</td>
</tr>
<tr>
<td>访问文件</td>
<td>否</td>
<td>是</td>
<td>是</td>
</tr>
<tr>
<td>访问用户界面</td>
<td>否</td>
<td>否</td>
<td>是</td>
</tr>
<tr>
<td>使用外部服务</td>
<td>否</td>
<td>不鼓励，可mock</td>
<td>是</td>
</tr>
<tr>
<td>多线程</td>
<td>否</td>
<td>是</td>
<td>是</td>
</tr>
<tr>
<td>使用sleep语句</td>
<td>否</td>
<td>是</td>
<td>是</td>
</tr>
<tr>
<td>使用系统属性设置</td>
<td>否</td>
<td>是</td>
<td>是</td>
</tr>
<tr>
<td>运行时间限制（毫秒）</td>
<td>60</td>
<td>300</td>
<td>900+</td>
</tr>
<tr>
<td>强制时间限制（分钟）</td>
<td>1</td>
<td>5</td>
<td>15</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>-</th>
<th>小型测试</th>
<th>中型测试</th>
<th>大型测试</th>
</tr>
</thead>
<tbody><tr>
<td>对应测试类型</td>
<td>单元测试</td>
<td>单元测试+逻辑层测试（泛单元或分层测试）</td>
<td>UI测试或接口测试</td>
</tr>
</tbody></table>
<h1 id="我的做法"><a href="#我的做法" class="headerlink" title="我的做法"></a>我的做法</h1><ul>
<li>遵守“金字塔”理论，UI层用例做薄，UT用例做厚</li>
<li>MVC后端项目分层测试，每层的用例对其下层调用时尽量打桩，即，mock它的下层、mock它所调用的函数，达到隔离所测类、实现只测当前类方法的目的</li>
<li>单元测试尽量不依赖数据库、外部服务、网络等等</li>
<li>以上3条只是尽量做到，视实际情况允许存在特例</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://peterquan.github.io/2020/06/11/use-junit5-in-lower-version-of-springboot/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.webp">
      <meta itemprop="name" content="权芹乐">
      <meta itemprop="description" content="时间需要留下走过的痕迹">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Quan Qinle">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/11/use-junit5-in-lower-version-of-springboot/" class="post-title-link" itemprop="url">Junit | 在Spring Boot2低版本中使用Junit 5</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-06-12 00:00:00" itemprop="dateCreated datePublished" datetime="2020-06-12T00:00:00+08:00">2020-06-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-07-03 17:28:26" itemprop="dateModified" datetime="2020-07-03T17:28:26+08:00">2020-07-03</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>先说结论：如果你用的<code>Spring Boot</code>版本是<code>2.2.0</code>或更新，那么，<code>spring-boot-starter-test</code>已自带<code>Junit 5</code>，本文对你无用，你可以直接在你的工程中编码了。</p>
<p>下文是<code>Spring Boot 2</code>版本低于<code>2.2.0.RELEASE</code>时的配置方法。</p>
<p>我的环境：</p>
<ul>
<li>Java 8+</li>
<li>Maven 3</li>
<li>Spring Boot 2.0.7.RELEASE</li>
<li>想使用Junit 5，且没有Junit 4的历史用例</li>
</ul>
<p>配置步骤不复杂，简单来说，从<code>spring-boot-starter-test</code>中去掉<code>Junit 4</code>，再引入<code>Junit 5</code>。<br>pom.xml需要修改的部分如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- Junit updates to version 5 since springboot 2.2--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.jupiter<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-jupiter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.6.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- unit test: Need at least 2.22.0 to support JUnit 5 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-surefire-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.22.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Tip：<code>junit-jupiter</code>已包含<code>junit-jupiter-engine</code>、<code>junit-jupiter-api</code>、<code>junit-jupiter-params</code>，所以，只引入它就够了。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://peterquan.github.io/2020/06/10/register-domain/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.webp">
      <meta itemprop="name" content="权芹乐">
      <meta itemprop="description" content="时间需要留下走过的痕迹">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Quan Qinle">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/10/register-domain/" class="post-title-link" itemprop="url">在porkbun注册域名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-06-11 00:00:00" itemprop="dateCreated datePublished" datetime="2020-06-11T00:00:00+08:00">2020-06-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-07-03 17:28:26" itemprop="dateModified" datetime="2020-07-03T17:28:26+08:00">2020-07-03</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="选择域名服务商"><a href="#选择域名服务商" class="headerlink" title="选择域名服务商"></a>选择域名服务商</h1><ul>
<li>开始时，考虑了<code>namecheap</code>、<code>namesilo</code>、<code>godaddy</code></li>
<li>网上搜索比较后，优先<code>namesilo</code></li>
<li>最终通过比价，选择<code>porkbun</code>。对于初级、低端域名玩家，<em>便宜</em>就是吸引力。</li>
</ul>
<blockquote>
<p>域名服务商价格比较工具：<a href="https://www.domcomp.com/" target="_blank" rel="noopener">www.domcomp.com</a></p>
</blockquote>
<p>另外，到期后，我考虑转到<code>namesilo</code>。</p>
<h1 id="在porkbun注册域名"><a href="#在porkbun注册域名" class="headerlink" title="在porkbun注册域名"></a>在<code>porkbun</code>注册域名</h1><p><a href="https://porkbun.com/" target="_blank" rel="noopener">porkbun</a>的特点：</p>
<ol>
<li>便宜</li>
<li>Free WHOIS Privacy：免费的Whois隐私保护</li>
<li>Free SSL Certificates：免费的SSL</li>
</ol>
<p>操作过程简单，不再赘述。</p>
<h1 id="增改DNS-RECORDS"><a href="#增改DNS-RECORDS" class="headerlink" title="增改DNS RECORDS"></a>增改<code>DNS RECORDS</code></h1><p>点击<code>DNS RECORDS</code>，可以看到默认已经提供了一些记录，它们都指向<code>porkbun</code>的默认网址。</p>
<p>因为我暂时只搭了博客，所以，添加一条DNS记录指向博客，其他的暂时保持原样。</p>
<ul>
<li>添加<code>CNAME类型</code>的记录</li>
<li><code>Host</code>填写blog，这个域名已在git中配置</li>
<li><code>Answer</code>填写我的github.io地址</li>
</ul>
<blockquote>
<p>【Tip】网址DNS记录最常用的类型是CNAME与ALIAS，简单说明二者的区别：</p>
<ul>
<li>CNAME：解析到其他域名</li>
<li>ALIAS：解析到ip</li>
</ul>
</blockquote>
<p>至此，域名注册和绑定已经完成，可以正常使用了。</p>
<p>如果想使用CDN，需要继续下面的步骤。</p>
<h1 id="把nameservers转移到cloudflare"><a href="#把nameservers转移到cloudflare" class="headerlink" title="把nameservers转移到cloudflare"></a>把nameservers转移到<code>cloudflare</code></h1><p>先看<a href="https://kb.porkbun.com/article/22-how-to-change-your-nameservers" target="_blank" rel="noopener">porkbun官方操作指引</a></p>
<blockquote>
<p>tip: <a href="https://dash.cloudflare.com/" target="_blank" rel="noopener">cloudflare</a>提供免费的CDN服务</p>
</blockquote>
<ol>
<li><p>登陆<code>cloudflare</code>，添加自己的域名</p>
</li>
<li><p><code>cloudflare</code>将自动扫描 DNS 记录</p>
<ul>
<li><strong>黄色云朵</strong>表示该解析通过 CDN 访问（隐藏网站真实 IP 地址，保护原站安全。）</li>
<li><strong>灰色云朵</strong>表示不通过 CDN 访问（相当于只使用 cloudflare 的 DNS 功能）</li>
<li>点击云朵可以切换状态。</li>
<li>手工添加缺失的记录</li>
</ul>
</li>
<li><p>在原域名供应商<code>porkbun</code>处，点击<code>AUTHORITATIVE NAMESERVERS</code>并修改</p>
</li>
</ol>
<p>删除以下所有</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">curitiba.porkbun.com</span><br><span class="line">fortaleza.porkbun.com</span><br><span class="line">maceio.porkbun.com</span><br><span class="line">salvador.porkbun.com</span><br></pre></td></tr></table></figure>

<p>替换为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dalary.ns.cloudflare.com</span><br><span class="line">rohin.ns.cloudflare.com</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>剩下就是等待<code>cloudflare</code>变成激活状态：<code>Status: Activity</code></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://peterquan.github.io/2020/06/06/Bypass-login-verification-with-cookies/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.webp">
      <meta itemprop="name" content="权芹乐">
      <meta itemprop="description" content="时间需要留下走过的痕迹">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Quan Qinle">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/06/Bypass-login-verification-with-cookies/" class="post-title-link" itemprop="url">Selenium | 自动登录脚本如何绕过二维码、校验码等安全校验</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-06-06 08:08:08" itemprop="dateCreated datePublished" datetime="2020-06-06T08:08:08+08:00">2020-06-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-06-09 09:09:09" itemprop="dateModified" datetime="2020-06-09T09:09:09+08:00">2020-06-09</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>做Web UI自动化测试的朋友，基本上都会遇到用户登录操作，然而基于安全性考虑，登录过程除了要求输入用户名和密码，往往还会存在为了防止自动化登陆而设置的更加复杂的校验。比如，<br><img src="/img/in-post/selenium-login-cookie/01.webp" alt="imag"></p>
<p>既然这些校验的存在就是为了对抗robot、防止自动化登陆，那么，它们自然就成了自动化登陆所面临的难题了。如果知道了这一点，你仍去试着用Selenium或其他技术进行破解，那么，在这样做之前，建议你先掂量掂量自己的技术实力吧。</p>
<h1 id="我们自己项目中的安全校验"><a href="#我们自己项目中的安全校验" class="headerlink" title="我们自己项目中的安全校验"></a>我们自己项目中的安全校验</h1><p>如果这种校验出现在我们自己的测试项目中，正如我在视频《Web UI自动化测试：Selenium入门》中所说，建议你和研发人员沟通，<strong>在test版本上去除它们，只保留用户和密码即可</strong>。</p>
<p>解决问题的方法有很多，换一种思路，一切豁然开朗。把“登录过程中二维码/短信验证”<strong>从自动化测试用例集中移出，放到手工测试用例集</strong>，技术难题就这么轻松愉快的解决了，码农再也不用为了苦思冥想、挠头掉发担心了。</p>
<p>各位看客，山不过来我就过去~~</p>
<h1 id="第三方网站中的安全校验"><a href="#第三方网站中的安全校验" class="headerlink" title="第三方网站中的安全校验"></a>第三方网站中的安全校验</h1><p>可是……如果你是在对第三方网站编写网页爬虫，或者编写一些自动化脚本，遇到防自动化登录校验，又该怎么办呢？现在可没有网站程序员帮你临时去掉这个功能模块了。</p>
<p>这种情况，正是本文需要讲解的内容。</p>
<h1 id="半自动化方案"><a href="#半自动化方案" class="headerlink" title="半自动化方案"></a>半自动化方案</h1><p>我的解决方案是这样的：</p>
<ol>
<li>人工登录所需网站。</li>
<li>提取页面请求头中的Cookie。</li>
<li>将Cookie添加到WebDriver。</li>
</ol>
<p>前两步很简单，应该是从业人员的基本功，不过多赘述，但下文也会演示。重点在第3步，我不确定Selenium是否提供了这样的API，幸运的是，最终在官方docs中找到所需的方法。</p>
<p>也许你已经发现了，经过这个方案的处理，我们的自动化变得不纯粹了，它变成了半自动化，因为获取请求Cookie的过程是人工的。Anyway，我的自动化脚本至少又可以运行起来了，加入一点点人工介入也是值得的。</p>
<p>另外一点不方便的是，Cookie中的登录信息都是有有效期的，无论这个网站登录时效使用的是Cookie还是Session，我们不可避免的都需要每隔一段时间重新手工登录网站，获取最新的Cookie，并在我们的代码中进行替换。</p>
<h1 id="演示"><a href="#演示" class="headerlink" title="演示"></a>演示</h1><p>下面我们以头条公众号后台为例演示整个过程。</p>
<h2 id="1、人工登录所需网站"><a href="#1、人工登录所需网站" class="headerlink" title="1、人工登录所需网站"></a>1、人工登录所需网站</h2><p>这一步就不演示了，可别泄露了我的密码。<br><img src="/img/in-post/selenium-login-cookie/02.webp" alt="imag"></p>
<h2 id="2、提取页面请求头中的Cookie"><a href="#2、提取页面请求头中的Cookie" class="headerlink" title="2、提取页面请求头中的Cookie"></a>2、提取页面请求头中的Cookie</h2><p>操作步骤：</p>
<ol>
<li>点击<kbd>F12</kbd>，打开“开发者工具”</li>
<li>刷新页面，捕获请求</li>
<li>在左侧请求列表中切换几次，找到<code>Request Headers</code>中<code>Cookie</code>有值的请求</li>
<li>Cookie字段后面的一长串字符串，就是我们需要的<br><img src="/img/in-post/selenium-login-cookie/03.webp" alt="imag"></li>
</ol>
<h2 id="3、将Cookie添加到WebDriver"><a href="#3、将Cookie添加到WebDriver" class="headerlink" title="3、将Cookie添加到WebDriver"></a>3、将Cookie添加到WebDriver</h2><p>上一步中得到的Cookie字符串还需要经过处理，因为它是很多Cookie以分号为分隔符拼接之后的内容，我们需要逆向操作：</p>
<ol>
<li>先以“分号<code>;</code>”为分隔符获取Cookie列表，</li>
<li>列表中的元素都含有=号，=左侧是Cookie的name，=右侧是Cookie的value，用name和value构造Cookie，</li>
<li>最后传给WebDriver。</li>
</ol>
<p>为了验证我们分析的 <strong>“Cookie字符串是以分号分隔、Cookie的name和value在=两侧”</strong>，我们仍回到“开发者工具”，切换到Cookies卡片下，查看Cookie列表完整信息：</p>
<p><img src="/img/in-post/selenium-login-cookie/04.webp" alt="imag"></p>
<h1 id="编码"><a href="#编码" class="headerlink" title="编码"></a>编码</h1><p>闲话少叙，我们开始编码吧。</p>
<p>先解析我们得到的原始Cookie字符串，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.openqa.selenium.Cookie;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将cookie字符串拆解到list中</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> rawCookie 原始Cookie字符串</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> Cookie列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Cookie&gt; <span class="title">parseRawCookie</span><span class="params">(String rawCookie)</span> </span>&#123;</span><br><span class="line">  List&lt;Cookie&gt; cookies = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">  String[] rawCookieParams = rawCookie.split(<span class="string">";"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (String cookieParam : rawCookieParams) &#123;</span><br><span class="line">    String[] rawCookieNameAndValue = cookieParam.split(<span class="string">"="</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">2</span> != rawCookieNameAndValue.length) &#123;</span><br><span class="line">      log.error(<span class="string">"Invalid cookie: missing name and value."</span>);</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    String cookieName = rawCookieNameAndValue[<span class="number">0</span>].trim();</span><br><span class="line">    String cookieValue = rawCookieNameAndValue[<span class="number">1</span>].trim();</span><br><span class="line">    Cookie cookie = <span class="keyword">new</span> Cookie(cookieName, cookieValue);</span><br><span class="line">    cookies.add(cookie);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> cookies;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>将上一步得到的Cookie列表添加给WebDriver，这一步需要放在所有需要权限验证的步骤之前。<br>我们可以先添加Cookie，然后刷新页面，这样我们打开的网页就是登陆状态了。<br><img src="/img/in-post/selenium-login-cookie/06.webp" alt="imag"></p>
<p>编码演示到这里就够用了，大家不妨试试。</p>
<h1 id="API补充说明"><a href="#API补充说明" class="headerlink" title="API补充说明"></a>API补充说明</h1><p>在这个解决方案中，我们主要用到了两个接口，它们还有一些相关接口，如有需要，请自行查阅。</p>
<h2 id="1、添加Cookie"><a href="#1、添加Cookie" class="headerlink" title="1、添加Cookie"></a>1、添加Cookie</h2><p><code>void addCookie(Cookie cookie) // Add a specific cookie.</code></p>
<ul>
<li>所属接口：<br><code>org.openqa.selenium.WebDriver.Options</code></li>
<li>相关方法：<br><code>java.util.Set&lt;Cookie&gt; getCookies()</code>、<code>deleteCookie(Cookie cookie)</code> 等等。</li>
</ul>
<h2 id="2、构造Cookie"><a href="#2、构造Cookie" class="headerlink" title="2、构造Cookie"></a>2、构造Cookie</h2><p><code>Cookie(java.lang.String name, java.lang.String value)</code></p>
<ul>
<li>所属接口：<br><code>org.openqa.selenium.Cookie</code></li>
<li>相关方法：<br><code>Cookie(java.lang.String name, java.lang.String value, java.lang.String domain, java.lang.String path, java.util.Date expiry, boolean isSecure, boolean isHttpOnly)</code> 等等</li>
</ul>
<p>官方docs地址，如下：<br><a href="https://seleniumhq.github.io/selenium/docs/api/java/" target="_blank" rel="noopener">https://seleniumhq.github.io/selenium/docs/api/java/</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://peterquan.github.io/2020/06/04/How-to-handle-LazyLoad-page-when-use-Selenium/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.webp">
      <meta itemprop="name" content="权芹乐">
      <meta itemprop="description" content="时间需要留下走过的痕迹">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Quan Qinle">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/04/How-to-handle-LazyLoad-page-when-use-Selenium/" class="post-title-link" itemprop="url">Selenium | 编写爬虫抓取网页图片遭遇懒加载</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-06-04 08:00:09" itemprop="dateCreated datePublished" datetime="2020-06-04T08:00:09+08:00">2020-06-04</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>缘起：</p>
<p>最近想重看一遍漫画《海贼王》，腾讯动漫上有完整的免费资源，先是在腾讯上看了一阵，后来又找了一个海贼小站的专门论坛，在其上的阅读体验更简洁一些。但是，无论网页怎样简化，浏览器的框架和网站的广告总是躲不掉，占据着阅读的视野。<br>于是，就想着把漫画所有的图片抓取到本地磁盘，然后通过图片查看器开全屏，悠哉悠哉地看……漫……画……</p>
</blockquote>
<p>有了需求，说干就干。</p>
<h1 id="Python实现爬虫，第1版"><a href="#Python实现爬虫，第1版" class="headerlink" title="Python实现爬虫，第1版"></a>Python实现爬虫，第1版</h1><p>这段时间又重新把Python用起来了，想的是如果什么问题都用Java解决，方式太重了，而且手里常备一个熟练的动态语言也是极其必要的，所以，稍微简单的任务，比如，文本处理、批量修改文件等，都改用Python了。另外，我在github上维护了一个<a href="https://github.com/quanqinle/my-python" target="_blank" rel="noopener">pythong小工具工程</a>，专门存放日常用到的Python脚本，留档下来方便以后遇到类似问题可以拿来直接用。</p>
<p>所以，这次的漫画图片抓取，我计划用Python编码实现。</p>
<p>此前已经编写过类似的网页文字和多媒体爬取脚本，见上面提到github工程中的<code>download_mp3_and_dialog.py</code>文件，它使用的是Lxml库。著名的网页抓取方式还有Beautiful Soup和正则等，当然，也可以用更强大了爬虫框架，只是，我的需求太简单，杀鸡焉用牛刀。</p>
<p>Python编码部分不复杂，编程主要的工作其实在分析网页结构，找到图片下载链接这些工作上。</p>
<h2 id="网页分析，CSS元素定位"><a href="#网页分析，CSS元素定位" class="headerlink" title="网页分析，CSS元素定位"></a>网页分析，CSS元素定位</h2><p>为了下载漫画，我们分析网页需要搞清楚3部分有用的内容。</p>
<h3 id="1-动漫每话的网页地址"><a href="#1-动漫每话的网页地址" class="headerlink" title="1.动漫每话的网页地址"></a>1.动漫每话的网页地址</h3><p>经过分析，我发现这个网站在组织每话的url时，规则非常简单且规整。比如，第1话是<code>www.fuckgfw.com/onepiece/0001</code>，那么，第188话就是<code>www.fuckgfw.com/onepiece/0188</code>，以此类推。</p>
<p>再找到《海贼王》当前的最后一话是917话，剩下的就是for循环和字符串拼接了。</p>
<blockquote>
<p>重要说明！！！</p>
<p>本文仅是技术分享，为了避免有人阅读本文后拿人家的网站做测试，本文隐去抓取的网站域名。这事儿咱一个人干也就干了，可不好传播~~</p>
</blockquote>
<h3 id="2-每话的题目"><a href="#2-每话的题目" class="headerlink" title="2.每话的题目"></a>2.每话的题目</h3><p>页面顶部就有漫画每话的题目，在页面源码中搜索后可以确认 <code>span标签的class属性值title-comicHeading</code> 在页面中是唯一的，我们就用它来定位元素，然后获取元素上的文本。</p>
<p>标题的CSS Selector语法是 <code>span.title-comicHeading</code> 。</p>
<p><img src="/img/in-post/selenium-lazyload/selenium-lazyload-02.webp" alt="imag"></p>
<h3 id="3-每话中图片资源地址"><a href="#3-每话中图片资源地址" class="headerlink" title="3.每话中图片资源地址"></a>3.每话中图片资源地址</h3><p>每话都有数量不等的漫画图片，页面识别后找到可以确保唯一性的图片元素定位方法，所有的图片都在标签 ul &gt; li 列表中，所以，我们可以获取图片img列表，然后遍历img列表，逐个下载即可。</p>
<p>定位img列表的CSS Selector语法是 <code>ul#comicContain li img</code> 。</p>
<p><img src="/img/in-post/selenium-lazyload/selenium-lazyload-03.webp" alt="imag"></p>
<h2 id="失败了……"><a href="#失败了……" class="headerlink" title="失败了……"></a>失败了……</h2><p>将以上的元素定位写入代码，修改后，先缩小话的for循化范围成从第1话开始到第2话结束，调试运行py。</p>
<p>有点小确幸，多谢佛祖保佑，脚本运行通过，没有报错。</p>
<p><img src="/img/in-post/selenium-lazyload/selenium-lazyload-04.webp" alt="imag"></p>
<p>打开本地磁盘，查看保存的图片。<br>糟糕，除了前面几张图，后面全部都是一模一样的小图片，以我的多年工作经验来分析——哎呀妈，这些都是占位图啊！</p>
<p><img src="/img/in-post/selenium-lazyload/selenium-lazyload-05.webp" alt="imag"></p>
<p>打开网页验证下自己的猜想。</p>
<p><img src="/img/in-post/selenium-lazyload/selenium-lazyload-07.webp" alt="imag"></p>
<p>确实像猜想的那样，当我没有浏览到处于页面下方的图片时，那里只有占位图，当页面向下滚动快要到达占位图时，img标签的src会被替换成真实的资源url，然后页面才加载图片。</p>
<h2 id="如何处理懒加载页面？"><a href="#如何处理懒加载页面？" class="headerlink" title="如何处理懒加载页面？"></a>如何处理懒加载页面？</h2><p>那么，问题就显而易见了，这个页面使用了“懒加载（lazy load）”，也叫做“延迟加载”。不过，想想又觉得理所应当，像这样包含大量大图的页面，不延迟加载才是怪事。</p>
<blockquote>
<p>惰性载入（英语：Lazy loading、Infinite Scroll，又称延迟载入、懒载入、无限卷动、瀑布流），是一种设计模式，被运用在软体设计和网页设计当中，对于网页界面，其特征为使用者透过滑鼠，卷动浏览页面，直到页面下方时，就会自动载入更多内容；有多数网站采用这项网页设计，例如Google图片搜索、Google+、Facebook、Twitter、Pinterest和维基百科的Flow讨论系统。也有结合无限卷动和多页，两著特性的网页设计。</p>
<p>– Wikipedia</p>
</blockquote>
<p>使用关键字“python 页面抓取 懒加载”在Google搜索一番，又使用相似的英文搜索，结果都指向一种解决方式：<strong>通过Selenium滚动页面触发js加载图片</strong>。</p>
<p>既然要用Selenium，那么，我还是换回Java来实现这次的需求吧，谁让咱是 Java + Selenium老手呢（见历史文章），转而去整Python + Selenium的话，又要重新学习，我可不想重复造轮子。</p>
<h1 id="Java实现爬虫，第2版"><a href="#Java实现爬虫，第2版" class="headerlink" title="Java实现爬虫，第2版"></a>Java实现爬虫，第2版</h1><p>很久前，我就已经在github上开源了一个UITest框架，借助Selenium和Appium，地址是 <a href="https://github.com/quanqinle/WebAndAppUITesting" target="_blank" rel="noopener">WebAndAppUITesting</a> 。这么小的需求没必要使用这套框架，从工程里借鉴一些代码即可。</p>
<p>第1版上我需要增加页面滚动的逻辑，按之前的经验需要加入JavaScript执行器的代码，可用的方式大致有以下几种：</p>
<p><img src="/img/in-post/selenium-lazyload/selenium-lazyload-08.webp" alt="imag"></p>
<p>不多说了，直接上代码吧</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.uitest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.Charset;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.FileAlreadyExistsException;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Path;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.StandardOpenOption;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.openqa.selenium.By;</span><br><span class="line"><span class="keyword">import</span> org.openqa.selenium.JavascriptExecutor;</span><br><span class="line"><span class="keyword">import</span> org.openqa.selenium.WebDriver;</span><br><span class="line"><span class="keyword">import</span> org.openqa.selenium.WebElement;</span><br><span class="line"><span class="keyword">import</span> org.openqa.selenium.chrome.ChromeDriver;</span><br><span class="line"><span class="keyword">import</span> org.openqa.selenium.chrome.ChromeOptions;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 下载 海贼王 漫画</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> quanqinle</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DownloadOnePiece</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        download();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">download</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> firstChap  = <span class="number">001</span>;</span><br><span class="line">        <span class="keyword">int</span> newestChap = <span class="number">947</span>;</span><br><span class="line">        String baseUrl = <span class="string">"https://I.cannot.tell.the.real.url/post/10%03d/"</span>;</span><br><span class="line">        String baseDir = <span class="string">"D:\\OnePiece\\%03d\\"</span>;</span><br><span class="line">        String baseFile = <span class="string">"D:\\OnePiece\\%03d\\%03d-%03d.jpg"</span>;</span><br><span class="line">        String chapterName = <span class="string">""</span>; <span class="comment">// 第2话 戴草帽的路飞</span></span><br><span class="line"></span><br><span class="line">        System.setProperty(<span class="string">"webdriver.chrome.driver"</span>, <span class="string">"C:\\chromedriver.exe"</span>);</span><br><span class="line">        ChromeOptions options = <span class="keyword">new</span> ChromeOptions();</span><br><span class="line">        options.addArguments(<span class="string">"headless"</span>);</span><br><span class="line">        WebDriver driver = <span class="keyword">new</span> ChromeDriver(options);</span><br><span class="line">        driver.get(<span class="string">"https://I.cannot.tell.you.the.real.url"</span>);</span><br><span class="line">        driver.manage().window().maximize();</span><br><span class="line">        driver.manage().timeouts().implicitlyWait(<span class="number">5</span>, TimeUnit.SECONDS);</span><br><span class="line"></span><br><span class="line">        JavascriptExecutor js = (JavascriptExecutor) driver;</span><br><span class="line"></span><br><span class="line">        List&lt;WebElement&gt; imgList = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> idxChap = firstChap; idxChap &lt;= newestChap; idxChap++) &#123;</span><br><span class="line">            driver.get(String.format(baseUrl, idxChap));</span><br><span class="line">            Thread.sleep(<span class="number">2</span> * <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">            chapterName = driver.findElement(By.cssSelector(<span class="string">"span.title-comicHeading"</span>)).getText();</span><br><span class="line">            toLog(String.format(<span class="string">"# [%03d] %s"</span>, idxChap, chapterName));</span><br><span class="line"></span><br><span class="line">            createFolder(String.format(baseDir, idxChap));</span><br><span class="line">            imgList = driver.findElements(By.cssSelector(<span class="string">"ul#comicContain li img"</span>));</span><br><span class="line">            <span class="keyword">int</span> imgIndex = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (WebElement img : imgList) &#123;</span><br><span class="line">                <span class="keyword">if</span> (img.getAttribute(<span class="string">"id"</span>).contains(<span class="string">"adBottom"</span>) </span><br><span class="line">                        || img.getAttribute(<span class="string">"id"</span>).contains(<span class="string">"adTop"</span>)</span><br><span class="line">                    || img.getAttribute(<span class="string">"src"</span>).contains(<span class="string">"006xpM3Tgy1feta1hkppuj30m8076wgh.jpg"</span>)) &#123;</span><br><span class="line">                    <span class="comment">// 漫画中间竟然穿插了广告图！</span></span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">/**</span></span><br><span class="line"><span class="comment">                 * 因为页面是懒加载，需滚动页面</span></span><br><span class="line"><span class="comment">                 */</span></span><br><span class="line">                js.executeScript(<span class="string">"arguments[0].scrollIntoView();"</span>, img);</span><br><span class="line">                Thread.sleep(<span class="number">300</span>);</span><br><span class="line"></span><br><span class="line">                String srcUrl = img.getAttribute(<span class="string">"src"</span>);</span><br><span class="line">                <span class="keyword">if</span> (srcUrl.contains(<span class="string">"pixel.gif"</span>)) &#123;</span><br><span class="line">                    toLog(String.format(<span class="string">"fail to load img [%03d - %03d]"</span>, idxChap, imgIndex++));</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                String destFile = String.format(baseFile, idxChap, idxChap, imgIndex);</span><br><span class="line"></span><br><span class="line">                toLog(String.format(<span class="string">"下载[%03d]：%s"</span>, imgIndex, srcUrl));</span><br><span class="line">                imgIndex++;</span><br><span class="line">                downloadFile(srcUrl, destFile);</span><br><span class="line">            &#125; <span class="comment">// 图片循环 end</span></span><br><span class="line"></span><br><span class="line">        &#125; <span class="comment">// 页面循环 end</span></span><br><span class="line"></span><br><span class="line">        driver.quit();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 下载指定资源到目标文件</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> url</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> destFile</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">downloadFile</span><span class="params">(String url, String destFile)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            InputStream in = <span class="keyword">new</span> URL(url).openStream();</span><br><span class="line">            Files.copy(in, Paths.get(destFile));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (FileAlreadyExistsException e) &#123;</span><br><span class="line">            toLog(<span class="string">"文件已存在："</span> + destFile);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建文件夹</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> folderName 文件夹名称</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">createFolder</span><span class="params">(String folderName)</span> </span>&#123;</span><br><span class="line">        File dirFile = <span class="keyword">new</span> File(folderName);</span><br><span class="line">        <span class="keyword">boolean</span> bFile = dirFile.exists();</span><br><span class="line">        <span class="keyword">if</span> (bFile == <span class="keyword">false</span>) &#123;</span><br><span class="line">            bFile = dirFile.mkdirs();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (bFile == <span class="keyword">true</span>) &#123;</span><br><span class="line">            toLog(<span class="string">"Create folder successfully! -- "</span> + folderName);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            toLog(<span class="string">"Create folder error! -- "</span> + folderName);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 写日志</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">toLog</span><span class="params">(String newline)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            List&lt;String&gt; lines = Arrays.asList(newline);</span><br><span class="line">            Path file = Paths.get(<span class="string">"D:\\onepiece.log"</span>);</span><br><span class="line">            System.out.println(newline);</span><br><span class="line">            Files.write(file, lines, Charset.forName(<span class="string">"UTF-8"</span>), StandardOpenOption.CREATE, StandardOpenOption.APPEND);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>需要注意的是，为了效率考虑，实际运行抓取图片时，我使用了“无界面的浏览器”，即代码段 <code>options.addArguments(&quot;headless&quot;);</code> 。</p>
<p>调试的时候可以注释该行，在有界面的情况下，观察运行效果。</p>
<p>另外提一句，我当前使用的chrome和driver在headless模式下出现了bug，变量chapterName总是空字符串，而有界面时，没有这个问题。</p>
<h2 id="再次运行代码"><a href="#再次运行代码" class="headerlink" title="再次运行代码"></a>再次运行代码</h2><p>再次运行代码，这次世界清静了，程序正常运行没报错，图片也正常下载了。只是代码执行比较慢，因为，为了保障页面加载、图片抓取的成功率，加了一些sleep等待。好在使用headless模式运行，把它收起在后台默默执行，也不影响我做别的事情。</p>
<p>一段时间后……</p>
<p><img src="/img/in-post/selenium-lazyload/selenium-lazyload-10.webp" alt="imag"></p>
<p>看漫画喽</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://peterquan.github.io/1999/12/31/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.webp">
      <meta itemprop="name" content="权芹乐">
      <meta itemprop="description" content="时间需要留下走过的痕迹">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Quan Qinle">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/1999/12/31/hello-world/" class="post-title-link" itemprop="url">Hello World</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2000-01-01 00:00:00" itemprop="dateCreated datePublished" datetime="2000-01-01T00:00:00+08:00">2000-01-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-07-03 17:28:26" itemprop="dateModified" datetime="2020-07-03T17:28:26+08:00">2020-07-03</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="权芹乐"
      src="/images/avatar.webp">
  <p class="site-author-name" itemprop="name">权芹乐</p>
  <div class="site-description" itemprop="description">时间需要留下走过的痕迹</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">8</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">权芹乐</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
