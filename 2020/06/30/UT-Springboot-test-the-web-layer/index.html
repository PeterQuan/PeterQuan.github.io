<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.webp">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.webp">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"peterquan.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="[toc] 我的环境：  Java 8+ Maven 3 Spring Boot 2 Junit 5  Controller的单元测试很多时候都不容易做到隔离，不得不依赖下层类的逻辑、数据库、网络、第三方服务等等，所以，有时人们又将它归为接口测试，类似于HTTP API测试。 测试的几种类型注意下面示例代码在类注释处的区别！ 1. 启动服务，监听端口，发送真实的http请求Start the ap">
<meta property="og:type" content="article">
<meta property="og:title" content="UT | Controller层单元测试">
<meta property="og:url" content="https://peterquan.github.io/2020/06/30/UT-Springboot-test-the-web-layer/index.html">
<meta property="og:site_name" content="Quan Qinle">
<meta property="og:description" content="[toc] 我的环境：  Java 8+ Maven 3 Spring Boot 2 Junit 5  Controller的单元测试很多时候都不容易做到隔离，不得不依赖下层类的逻辑、数据库、网络、第三方服务等等，所以，有时人们又将它归为接口测试，类似于HTTP API测试。 测试的几种类型注意下面示例代码在类注释处的区别！ 1. 启动服务，监听端口，发送真实的http请求Start the ap">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2020-06-30T16:00:00.000Z">
<meta property="article:modified_time" content="2020-07-30T07:13:00.625Z">
<meta property="article:author" content="权芹乐">
<meta property="article:tag" content="自动化测试">
<meta property="article:tag" content="Junit">
<meta property="article:tag" content="Spring Boot">
<meta property="article:tag" content="Unit Testing">
<meta property="article:tag" content="单元测试">
<meta property="article:tag" content="Automated Testing">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://peterquan.github.io/2020/06/30/UT-Springboot-test-the-web-layer/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>UT | Controller层单元测试 | Quan Qinle</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Quan Qinle</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">权芹乐的博客 | QuanQinle's Blog</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://peterquan.github.io/2020/06/30/UT-Springboot-test-the-web-layer/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.webp">
      <meta itemprop="name" content="权芹乐">
      <meta itemprop="description" content="时间需要留下走过的痕迹">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Quan Qinle">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          UT | Controller层单元测试
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-07-01 00:00:00" itemprop="dateCreated datePublished" datetime="2020-07-01T00:00:00+08:00">2020-07-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-07-30 15:13:00" itemprop="dateModified" datetime="2020-07-30T15:13:00+08:00">2020-07-30</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>[toc]</p>
<p>我的环境：</p>
<ul>
<li>Java 8+</li>
<li>Maven 3</li>
<li>Spring Boot 2</li>
<li>Junit 5</li>
</ul>
<p>Controller的单元测试很多时候都不容易做到隔离，不得不依赖下层类的逻辑、数据库、网络、第三方服务等等，所以，有时人们又将它归为接口测试，类似于HTTP API测试。</p>
<h1 id="测试的几种类型"><a href="#测试的几种类型" class="headerlink" title="测试的几种类型"></a>测试的几种类型</h1><p>注意下面示例代码在类注释处的区别！</p>
<h2 id="1-启动服务，监听端口，发送真实的http请求"><a href="#1-启动服务，监听端口，发送真实的http请求" class="headerlink" title="1. 启动服务，监听端口，发送真实的http请求"></a>1. 启动服务，监听端口，发送真实的http请求</h2><p>Start the application up and listen for a connection like it would do in production, and then send an HTTP request and assert the response.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.test.web.client.TestRestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@RunWith</span>(SpringRunner.class) // needed if junit 4</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ExtendWith</span>(SpringExtension.class) // for junit 5</span></span><br><span class="line"><span class="comment"> * 正常情况下可省略，因<span class="doctag">@SpringBootTest</span>已包含，但是，如果你用的spring boot版本低，还是加上这个注解吧</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootTest</span>(webEnvironment = WebEnvironment.RANDOM_PORT)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpRequestTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@LocalServerPort</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> port; <span class="comment">// bind the above RANDOM_PORT</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  <span class="keyword">private</span> TestRestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGreeting</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    assertThat(restTemplate.getForObject(<span class="string">"http://localhost:"</span> + port + <span class="string">"/"</span>, String<span class="class">.<span class="keyword">class</span>))</span></span><br><span class="line">      .contains("Hello World");</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-不启动服务（但实例化整个上下文），却类似发送真实http请求"><a href="#2-不启动服务（但实例化整个上下文），却类似发送真实http请求" class="headerlink" title="2. 不启动服务（但实例化整个上下文），却类似发送真实http请求"></a>2. 不启动服务（但实例化整个上下文），却类似发送真实http请求</h2><p>The full Spring application context is started but without the server.</p>
<p>Another useful approach is to not start the server at all, but test only the layer below that, where Spring handles the incoming HTTP request and hands it off to your controller. That way, almost the full stack is used, and your code will be called exactly the same way as if it was processing a real HTTP request, but without the cost of starting the server.</p>
<blockquote>
<p>译：另一种有用的方法是根本不启动服务器，而是只测试下面的层，Spring在这一层处理传入的HTTP请求并将其传递给控制器。这样，几乎使用了整个堆栈，代码调用的方式与处理实际HTTP请求的方式完全相同，但是不需要启动服务器。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.web.servlet.MockMvc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.test.web.servlet.result.MockMvcResultMatchers.content;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@AutoConfigureMockMvc</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MockMvcExampleTests</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  <span class="keyword">private</span> MockMvc mvc;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">testHelloWorld</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    mvc.perform(get(<span class="string">"/"</span>))</span><br><span class="line">      .andExpect(status().isOk())</span><br><span class="line">      .andExpect(content().string(<span class="string">"Hello World"</span>));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上两种方法会实例化整个上下文。（Spring Boot is instantiating the whole context.）</p>
<p>可以将<code>@SpringBootTest</code>理解成集成测试。</p>
<hr>
<p><em>注意上下两段代码，在类注释处的区别</em>  </p>
<p>方法3只实例化web层。<br>Spring Boot is only instantiating the web layer.（If you want to focus <strong><span style="color:red"><em>only</em></span> on the web layer</strong> and <strong><span style="color:red"><em>not start</em></span> a complete ApplicationContext</strong>, consider using <code>@WebMvcTest</code> instead.）</p>
<h2 id="3-不启动服务（仅实例化web层），却类似发送真实http请求"><a href="#3-不启动服务（仅实例化web层），却类似发送真实http请求" class="headerlink" title="3. 不启动服务（仅实例化web层），却类似发送真实http请求"></a>3. 不启动服务（仅实例化web层），却类似发送真实http请求</h2><p>In this test, the full Spring application context is started, but without the server. We can narrow down the tests to just the web layer by using <code>@WebMvcTest</code>.  </p>
<blockquote>
<p>译：在这个测试中，启动了完整的Spring应用程序上下文，但是没有服务器。我们可以使用<code>@WebMvcTest</code>将测试范围缩小到web层。<br>如果应用含有多个controller，可以使用<code>@WebMvcTest(homecontroler.class)</code>来只实例化一个控制器。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebMvcTest</span>(GreetingController<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">WebMockTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  <span class="keyword">private</span> MockMvc mockMvc;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@MockBean</span></span><br><span class="line">  <span class="keyword">private</span> GreetingService service;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGreetingShouldReturnMessageFromService</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    when(service.greet()).thenReturn(<span class="string">"Hello Mock"</span>);</span><br><span class="line"></span><br><span class="line">    mockMvc.perform(get(<span class="string">"/greeting"</span>))</span><br><span class="line">      .accept(MediaType.APPLICATION_JSON_UTF8)</span><br><span class="line">      <span class="comment">// 添加ResultHandler结果处理器，比如调试时打印结果到控制台，更多处理器可查阅</span></span><br><span class="line">      .andDo(print())</span><br><span class="line">      <span class="comment">// 添加ResultMatcher验证规则，验证请求结果是否正确</span></span><br><span class="line">      .andExpect(status().isOk())</span><br><span class="line">      <span class="comment">// andReturn：返回执行请求的结果，该结果是一个MvcResult实例对象</span></span><br><span class="line">      .andExpect(content().string(containsString(<span class="string">"Hello Mock"</span>)));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-Mock下层所有调用"><a href="#4-Mock下层所有调用" class="headerlink" title="4. Mock下层所有调用"></a>4. Mock下层所有调用</h2><p>只关注<code>Controller</code>层逻辑，被测中所涉及的调用全部打桩、mock掉。</p>
<p>与其他三个相比，方法4是比较合乎分层测试理念的方式。但在实际项目中，个人的体会，这种方式可操作性并不强。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MockitoControllerTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@InjectMocks</span></span><br><span class="line">  <span class="keyword">private</span> UserController userController;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Mock</span></span><br><span class="line">  <span class="keyword">private</span> UserRepository userRepository;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@BeforeEach</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    MockitoAnnotations.initMocks(<span class="keyword">this</span>); <span class="comment">//【必须！】初始化@Mock</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetUserById</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    User u = <span class="keyword">new</span> User();</span><br><span class="line">    u.setId(<span class="number">1L</span>);</span><br><span class="line">    </span><br><span class="line">    when(userRepository.findOne(<span class="number">1L</span>)).thenReturn(u);</span><br><span class="line"></span><br><span class="line">    User user = userController.get(<span class="number">1L</span>);</span><br><span class="line">    verify(userRepository).findOne(<span class="number">1L</span>);</span><br><span class="line">    assertEquals(<span class="number">1l</span>, user.getId().longValue());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="重要注解"><a href="#重要注解" class="headerlink" title="重要注解"></a>重要注解</h1><h2 id="SpringBootTest"><a href="#SpringBootTest" class="headerlink" title="@SpringBootTest"></a><code>@SpringBootTest</code></h2><p>The <code>@SpringBootTest</code> annotation tells Spring Boot to go and look for a main configuration class (one with <code>@SpringBootApplication</code> for instance), and use that to <strong>start a Spring application context</strong>.</p>
<p>注释告诉SpringBoot去寻找一个主配置类（例如带有<code>@SpringBootApplication</code>的配置类），并使用它来启动一个Spring应用程序上下文。</p>
<blockquote>
<p>Springboot默认只启动一次应用，并缓存它。对于使用配置相同的多个tc，或者一个tc中的多个method，就可以共用它。当然，可以使用<code>@DirtiesContext</code>来控制缓存。</p>
</blockquote>
<p>它有两个属性：</p>
<ul>
<li>webEnvironment：指定Web应用环境，它可以是以下值<ul>
<li>MOCK：提供一个模拟的 Servlet 环境，内置的 Servlet 容器没有启动（不会对Servlet、Filter、Listener等进行初始化），配合可以与@AutoConfigureMockMvc 结合使用，用于基于 MockMvc 的应用程序测试。</li>
<li>RANDOM_PORT：加载一个 EmbeddedWebApplicationContext 并提供一个真正嵌入式的 Servlet 环境，随机端口。</li>
<li>DEFINED_PORT：加载一个 EmbeddedWebApplicationContext 并提供一个真正嵌入式的 Servlet 环境，默认端口 8080 或由配置文件指定。</li>
<li>NONE：使用 SpringApplication 加载 ApplicationContext，但不提供任何 servlet 环境。</li>
</ul>
</li>
<li>classes：指定应用启动类，通常情况下无需设置，因为 SpringBoot 会自动搜索，直到找到 @SpringBootApplication 或 @SpringBootConfiguration 注解。</li>
</ul>
<h2 id="Transactional"><a href="#Transactional" class="headerlink" title="@Transactional"></a><code>@Transactional</code></h2><p>它会在每个测试方法结束时会进行回滚操作。<br>但是，如果使用 <code>RANDOM_PORT</code> 或 <code>DEFINED_PORT</code> 这样的Servlet环境，HTTP客户端和服务器将在不同的线程中运行，从而分离事务。所以，在这种情况下，在服务器上启动的任何事务都不会回滚。</p>
<h1 id="资料"><a href="#资料" class="headerlink" title="资料"></a>资料</h1><p><a href="https://spring.io/guides/gs/testing-web/" target="_blank" rel="noopener">Offical &gt; Testing the Web Layer</a></p>

    </div>

    
    
    
        

  <div class="followme">
    <p>欢迎关注我的其它发布渠道</p>

    <div class="social-list">

        <div class="social-item">
          <a target="_blank" class="social-link" href="https://twitter.com/quanqinle">
            <span class="icon">
              <i class="fab fa-twitter"></i>
            </span>

            <span class="label">Twitter</span>
          </a>
        </div>

        <div class="social-item">
          <a target="_blank" class="social-link" href="https://t.me/quanqinle">
            <span class="icon">
              <i class="fab fa-telegram"></i>
            </span>

            <span class="label">Telegram</span>
          </a>
        </div>
    </div>
  </div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/" rel="tag"># 自动化测试</a>
              <a href="/tags/Junit/" rel="tag"># Junit</a>
              <a href="/tags/Spring-Boot/" rel="tag"># Spring Boot</a>
              <a href="/tags/Unit-Testing/" rel="tag"># Unit Testing</a>
              <a href="/tags/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/" rel="tag"># 单元测试</a>
              <a href="/tags/Automated-Testing/" rel="tag"># Automated Testing</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/06/29/CSS-Selector-summary/" rel="prev" title="Selenium | 元素定位By.cssSelector()">
      <i class="fa fa-chevron-left"></i> Selenium | 元素定位By.cssSelector()
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/07/04/Xiaomi-install-custom-ROM/" rel="next" title="小米6刷机">
      小米6刷机 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#测试的几种类型"><span class="nav-number">1.</span> <span class="nav-text">测试的几种类型</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-启动服务，监听端口，发送真实的http请求"><span class="nav-number">1.1.</span> <span class="nav-text">1. 启动服务，监听端口，发送真实的http请求</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-不启动服务（但实例化整个上下文），却类似发送真实http请求"><span class="nav-number">1.2.</span> <span class="nav-text">2. 不启动服务（但实例化整个上下文），却类似发送真实http请求</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-不启动服务（仅实例化web层），却类似发送真实http请求"><span class="nav-number">1.3.</span> <span class="nav-text">3. 不启动服务（仅实例化web层），却类似发送真实http请求</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-Mock下层所有调用"><span class="nav-number">1.4.</span> <span class="nav-text">4. Mock下层所有调用</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#重要注解"><span class="nav-number">2.</span> <span class="nav-text">重要注解</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#SpringBootTest"><span class="nav-number">2.1.</span> <span class="nav-text">@SpringBootTest</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Transactional"><span class="nav-number">2.2.</span> <span class="nav-text">@Transactional</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#资料"><span class="nav-number">3.</span> <span class="nav-text">资料</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="权芹乐"
      src="/images/avatar.webp">
  <p class="site-author-name" itemprop="name">权芹乐</p>
  <div class="site-description" itemprop="description">时间需要留下走过的痕迹</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">10</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">19</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">权芹乐</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
